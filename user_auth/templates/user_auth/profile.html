{% extends 'base.html' %}
{% load static %}
{% load star_filters %}
{% load widget_tweaks %}

{% block title %}Profile | SkillSwap{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="card shadow-lg rounded-4 p-4 mb-5">
    <div class="d-flex flex-column flex-md-row align-items-center">

      {% if user.userdetail.profile_pic %}
        <img src="{{ user.userdetail.profile_pic.url }}" alt="Profile photo"
             class="rounded-circle mb-3 mb-md-0 mr-md-4"
             style="width: 150px; height: 150px; object-fit: cover;" />
      {% else %}
        <div class="bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center mb-3 mb-md-0 mr-md-4"
             style="width: 150px; height: 150px; font-size: 4rem;">
          🧑‍🎓
        </div>
      {% endif %}

      <div class="flex-grow-1">
        <h3 class="mb-1 font-weight-bold">{{ user.username }}</h3>
        <p class="mb-1"><strong>Email:</strong> {{ user.email }}</p>
        <p class="text-muted mb-2">{{ user.userdetail.description|default:"No description available." }}</p>
        <p class="mb-1"><strong>Location:</strong> {{ user.userdetail.location|default:"Not specified" }}</p>
        <p class="mb-3"><strong>Availability:</strong> {{ user.userdetail.availability|default:"Not specified" }}</p>
        <a href="{% url 'profile_edit' %}" class="btn btn-outline-secondary btn-sm rounded-pill px-4">Edit Profile</a>
      </div>
    </div>
  </div>

  <h2 class="mb-4 text-center text-md-left">{{ user_profile.username }}'s Skills</h2>

  {% if skills %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      {% for skill in skills %}
        <div class="col d-flex">
          <div class="card shadow-sm rounded-4 flex-fill d-flex flex-column">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ skill.title }}</h5>
              <p class="card-text mb-1"><strong>Location:</strong> {{ skill.location }}</p>
              <p class="card-text mb-1"><strong>Category:</strong> {{ skill.category }}</p>
              <p class="card-text mb-2"><strong>Availability:</strong> {{ skill.availability }}</p>
              {% if skill.average_rating %}
                <p class="mb-0">
                  Average Rating:
                  <span class="text-warning">{{ skill.average_rating|star_rating }}</span>
                  ({{ skill.review_count }} review{{ skill.review_count|pluralize }})
                </p>
              {% else %}
                <p class="text-muted mb-0">No reviews yet.</p>
              {% endif %}
              <a href="{% url 'skill_detail' skill.id %}?next=profile" class="btn btn-outline-primary btn-sm mt-auto rounded-pill">View Details</a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-center text-muted fst-italic">This user has not listed any skills yet.</p>
  {% endif %}
</div>
{% endblock %}
